from dotenv import load_dotenv
from langchain_google_genai import GoogleGenerativeAIEmbeddings

from google.cloud.firestore_v1.vector import Vector
from google.cloud import firestore
from google.cloud.firestore_v1.base_vector_query import DistanceMeasure

load_dotenv()
db = firestore.Client()
embeddings = GoogleGenerativeAIEmbeddings(model="models/embedding-001")

# test_query = "Kredit Usaha Rakyat BCA"
test_query = "Jelaskan BNI eForm KUR Mikro Disclaimer"


print(f"Testing with query: '{test_query}'")

query_vector = embeddings.embed_query(test_query)
print(f"Generated a vector with {len(query_vector)} dimensions.")
# print(f"Query_Vector non vectorized: {query_vector}")
# print(f"Query_Vector vectorized: {Vector(query_vector)}")

collection_ref = db.collection("bank_products_vectors_test")
firestore_query = collection_ref.find_nearest(
    vector_field="embedding",
    # query_vector=Vector(query_vector),
    # query_vector=query_vector,
    query_vector=Vector(
        [
            0.00931019987910986,
            -0.02953689731657505,
            -0.043071355670690536,
            0.03866923600435257,
            0.0713241770863533,
            -0.0063400897197425365,
            -0.02025005593895912,
            -0.04427001625299454,
            -0.037614721804857254,
            0.036113668233156204,
            0.002379676327109337,
            0.0022523028310388327,
            -0.027960538864135742,
            -0.013777915388345718,
            -0.046401262283325195,
            -0.03529033437371254,
            0.005178481340408325,
            0.001848104177042842,
            0.00604878319427371,
            -0.028926849365234375,
            -0.044716548174619675,
            0.02740539237856865,
            0.017631174996495247,
            -0.03815078362822533,
            0.013508440926671028,
            -0.01861543208360672,
            0.011883791536092758,
            -0.09343311190605164,
            -0.06882750988006592,
            0.021124472841620445,
            -0.03823526203632355,
            0.07678775489330292,
            -0.034736767411231995,
            0.003724557813256979,
            -0.025527922436594963,
            -0.047836918383836746,
            -0.024626027792692184,
            0.011534390971064568,
            -0.02085178531706333,
            0.04872125759720802,
            0.009400603361427784,
            0.023228628560900688,
            -0.013422475196421146,
            -0.02528664469718933,
            -0.018075669184327126,
            0.005443712696433067,
            -0.006917414255440235,
            -0.008983624167740345,
            0.07467074692249298,
            -0.027726616710424423,
            -0.034906163811683655,
            -0.012696478515863419,
            0.033547163009643555,
            -0.00026267830980941653,
            0.030225854367017746,
            -0.03875799849629402,
            0.05283530801534653,
            -0.0417763851583004,
            -0.004770174622535706,
            -0.022778138518333435,
            0.034225497394800186,
            0.027882255613803864,
            0.028968965634703636,
            0.009202876128256321,
            -0.0546749010682106,
            -0.03204813972115517,
            -0.03854656592011452,
            0.00746347988024354,
            0.06573279947042465,
            -0.02900073491036892,
            0.0029056428465992212,
            0.016289250925183296,
            0.07531771808862686,
            0.014022303745150566,
            -0.03928070515394211,
            -0.0660138726234436,
            -0.015596706420183182,
            0.04144084081053734,
            0.020936988294124603,
            -0.002573224948719144,
            0.03666306287050247,
            -0.07401467859745026,
            -0.01721467450261116,
            -0.042947255074977875,
            -0.0313284769654274,
            0.07902540266513824,
            -0.0319262370467186,
            -0.02791999839246273,
            0.041708510369062424,
            0.00007345400808844715,
            0.005687658209353685,
            -0.02266964316368103,
            0.0526309534907341,
            -0.0646263062953949,
            -0.001851449254900217,
            0.05684208869934082,
            -0.007975490763783455,
            -0.049030885100364685,
            -0.008819567039608955,
            -0.00676470622420311,
            -0.02281337045133114,
            -0.029192062094807625,
            -0.04001810401678085,
            -0.02722916565835476,
            0.008674082346260548,
            0.04609106108546257,
            -0.048642586916685104,
            0.0348796620965004,
            -0.03777797147631645,
            0.028955629095435143,
            -0.0655817911028862,
            -0.03057803586125374,
            -0.004656386096030474,
            -0.03198340907692909,
            0.08182419091463089,
            -0.00654898164793849,
            0.014395149424672127,
            0.10625562071800232,
            0.022598417475819588,
            0.03141607716679573,
            0.03448385000228882,
            0.009757143445312977,
            0.05653031915426254,
            -0.011172217316925526,
            0.018388846889138222,
            -0.03300734609365463,
            -0.05800160393118858,
            0.03229743614792824,
            0.013306913897395134,
            0.04187176749110222,
            -0.02394101954996586,
            -0.013142790645360947,
            -0.056567419320344925,
            0.013393236324191093,
            0.061518725007772446,
            0.05806677043437958,
            0.02977018803358078,
            0.030766798183321953,
            0.014677396044135094,
            0.005998676642775536,
            -0.024753345176577568,
            0.018823368474841118,
            0.016615845263004303,
            0.00787992961704731,
            0.013673885725438595,
            0.034586403518915176,
            -0.016984224319458008,
            0.022070396691560745,
            0.11521473526954651,
            -0.015082634054124355,
            0.0034260274842381477,
            -0.016840729862451553,
            -0.03522348776459694,
            0.0019119406351819634,
            0.015517164021730423,
            0.04856622591614723,
            0.028218749910593033,
            0.039627086371183395,
            -0.0005079425172880292,
            0.030149204656481743,
            -0.037987399846315384,
            -0.007208898197859526,
            0.007887797430157661,
            0.026858193799853325,
            -0.03633109852671623,
            -0.03007354959845543,
            0.06319601833820343,
            -0.0042872354388237,
            0.01242398377507925,
            0.0050993119366467,
            0.025377409532666206,
            0.04002055525779724,
            -0.039110325276851654,
            -0.006253077182918787,
            -0.00700546195730567,
            -0.03463427349925041,
            0.04597922042012215,
            -0.01071222499012947,
            0.02176566608250141,
            -0.003407958196476102,
            -0.04487935081124306,
            -0.008209457620978355,
            0.009301295503973961,
            0.009441828355193138,
            0.0665915384888649,
            -0.06430917978286743,
            0.12529762089252472,
            0.02494845725595951,
            -0.04675231873989105,
            0.04031575471162796,
            -0.007329711690545082,
            0.004375115502625704,
            -0.00286257010884583,
            -0.03764285892248154,
            -0.07867233455181122,
            0.023282835260033607,
            0.0002709238324314356,
            0.002574082463979721,
            0.04117002710700035,
            -0.03210669755935669,
            -0.009881586767733097,
            0.027548404410481453,
            0.009933952242136002,
            0.014756024815142155,
            0.057968560606241226,
            -0.0710020512342453,
            0.021709024906158447,
            -0.036713141947984695,
            -0.031163398176431656,
            0.035851798951625824,
            -0.06040862202644348,
            0.015036448836326599,
            -0.0696726143360138,
            0.04229039326310158,
            0.05290091037750244,
            0.027993209660053253,
            0.013956340961158276,
            0.0025174051988869905,
            -0.008372075855731964,
            -0.019993849098682404,
            -0.01689300686120987,
            0.009020705707371235,
            0.013978540897369385,
            0.009906473569571972,
            -0.023444024845957756,
            0.043778274208307266,
            -0.005798288621008396,
            0.046580735594034195,
            0.05027841776609421,
            -0.017529351636767387,
            0.0018230905989184976,
            0.06295037269592285,
            -0.012001040391623974,
            0.0066734314896166325,
            0.03652089461684227,
            0.012978808954358101,
            0.02856130711734295,
            0.05935600399971008,
            0.022608188912272453,
            0.07260371744632721,
            -0.05700398236513138,
            0.04471934586763382,
            0.037058275192976,
            0.007285889238119125,
            -0.07764777541160583,
            -0.04562303051352501,
            -0.03147256374359131,
            0.03385104238986969,
            0.013813148252665997,
            0.06682420521974564,
            -0.02221274934709072,
            -0.06356438994407654,
            0.013308096677064896,
            -0.005817572120577097,
            0.003047999693080783,
            0.027667896822094917,
            -0.013368832878768444,
            0.060731712728738785,
            0.0380464568734169,
            -0.01851876638829708,
            0.03497935086488724,
            0.013426014222204685,
            0.0019564994145184755,
            0.027361435815691948,
            0.05029401555657387,
            -0.035233981907367706,
            -0.0032022756058722734,
            -0.0673162192106247,
            -0.029426364228129387,
            0.04235057905316353,
            -0.01244209986180067,
            -0.007257592398673296,
            0.0369374118745327,
            0.051837921142578125,
            0.003289127256721258,
            0.011557456105947495,
            0.01628168858587742,
            0.06273861229419708,
            0.030304189771413803,
            -0.019569549709558487,
            -0.033837608993053436,
            -0.0013479198096320033,
            0.022450385615229607,
            -0.015602407976984978,
            -0.02060975879430771,
            -0.040778566151857376,
            -0.03260047361254692,
            -0.0606512725353241,
            0.044377680867910385,
            -0.05225341022014618,
            -0.03513903170824051,
            0.015847409144043922,
            0.03302539512515068,
            0.008253144100308418,
            -0.08224613964557648,
            0.030841931700706482,
            -0.059331849217414856,
            0.01140021625906229,
            -0.013103711418807507,
            0.00017675319395493716,
            0.0007037208997644484,
            -0.07750005275011063,
            0.01195397600531578,
            -0.0701407790184021,
            -0.01331733725965023,
            0.027308804914355278,
            -0.019974006339907646,
            -0.062261901795864105,
            0.020210759714245796,
            0.014514525420963764,
            0.04544160142540932,
            -0.05657944083213806,
            -0.04414001479744911,
            0.003095824969932437,
            0.04374394938349724,
            0.04206100478768349,
            -0.02920488826930523,
            0.005379532463848591,
            -0.018726570531725883,
            0.0672372356057167,
            0.026616374030709267,
            0.04760221019387245,
            0.020026734098792076,
            -0.022984890267252922,
            0.0077530075795948505,
            -0.0063423276878893375,
            -0.01343348529189825,
            0.02454712986946106,
            -0.0021226592361927032,
            0.020245473831892014,
            0.00533048901706934,
            -0.030779501423239708,
            -0.015199985355138779,
            0.04997289925813675,
            0.007970386184751987,
            0.04175247251987457,
            -0.0901506170630455,
            -0.025242919102311134,
            -0.025229256600141525,
            -0.0120084248483181,
            0.04011862352490425,
            -0.01607191003859043,
            -0.007244359701871872,
            -0.045094750821590424,
            0.012875080108642578,
            0.022683952003717422,
            -0.07108666002750397,
            -0.0014926842413842678,
            0.06868921965360641,
            0.03991882875561714,
            0.012525854632258415,
            0.009915938600897789,
            -0.005086636636406183,
            -0.005625561345368624,
            -0.0009710236336104572,
            -0.03506572172045708,
            0.05956171825528145,
            0.012187337502837181,
            0.02768615260720253,
            0.013558268547058105,
            -0.0049967593513429165,
            0.055644161999225616,
            -0.010892453603446484,
            -0.03170078247785568,
            0.012454229407012463,
            -0.020613741129636765,
            -0.011266134679317474,
            0.019701361656188965,
            -0.032089993357658386,
            0.011413292028009892,
            0.0017021449748426676,
            -0.06290526688098907,
            0.07677141577005386,
            -0.018585139885544777,
            -0.009542235173285007,
            -0.017361190170049667,
            -0.005812724586576223,
            -0.016082217916846275,
            -0.012590138241648674,
            0.014293286949396133,
            0.007277668919414282,
            -0.02324926294386387,
            0.0398394800722599,
            -0.0019233222119510174,
            -0.025375744327902794,
            -0.018724529072642326,
            0.07297219336032867,
            -0.017732642590999603,
            0.019262252375483513,
            0.04893415793776512,
            -0.042197201400995255,
            0.007144934963434935,
            0.0809776782989502,
            0.030288610607385635,
            0.007422448135912418,
            -0.01986483298242092,
            -0.09000810235738754,
            -0.03187790885567665,
            -0.00021677806216757745,
            0.04322296008467674,
            0.012264326214790344,
            -0.011503336951136589,
            -0.014739935286343098,
            -0.029384514316916466,
            -0.02412668988108635,
            0.021266156807541847,
            -0.0076719303615391254,
            -0.09108869731426239,
            0.014016717672348022,
            0.015686795115470886,
            -0.04419862851500511,
            0.005620806477963924,
            0.021766023710370064,
            -0.10552859306335449,
            -0.006365588866174221,
            0.006634801626205444,
            0.026057017967104912,
            0.01795649342238903,
            -0.011394361034035683,
            0.02789643593132496,
            -0.031727977097034454,
            0.01311113778501749,
            0.016419414430856705,
            -0.03302254155278206,
            -0.04089720919728279,
            -0.06366832554340363,
            0.017185870558023453,
            0.0022192825563251972,
            0.01450528483837843,
            0.026681803166866302,
            0.02084617130458355,
            -0.03127836808562279,
            0.03974538668990135,
            -0.0313803106546402,
            -0.019470803439617157,
            -0.06099233403801918,
            0.032962195575237274,
            0.03175225481390953,
            -0.004297028761357069,
            -0.033618878573179245,
            0.038640473037958145,
            0.032293111085891724,
            0.017022334039211273,
            0.012089534662663937,
            -0.004718177951872349,
            -0.02578243799507618,
            0.014277637004852295,
            -0.019914813339710236,
            0.05318392068147659,
            -0.03259057179093361,
            0.030415039509534836,
            -0.040028166025877,
            -0.07391034066677094,
            -0.01668418198823929,
            -0.01771329715847969,
            -0.032352183014154434,
            -0.010485028848052025,
            0.06502068787813187,
            -0.010693726129829884,
            0.013270813971757889,
            -0.03177294135093689,
            0.035707540810108185,
            0.028039662167429924,
            -0.04039350897073746,
            0.03029048442840576,
            0.026792891323566437,
            0.016414079815149307,
            -0.043574150651693344,
            0.057899486273527145,
            0.04671122133731842,
            0.03071689046919346,
            -0.026598313823342323,
            0.007420938462018967,
            -0.07357240468263626,
            -0.01977461203932762,
            -0.018649134784936905,
            -0.08900225162506104,
            0.019250662997364998,
            -0.03022911585867405,
            0.029927607625722885,
            -0.058434780687093735,
            -0.023050721734762192,
            0.062458693981170654,
            0.0028877065051347017,
            -0.03095894120633602,
            0.009069760330021381,
            -0.02676359750330448,
            -0.020597022026777267,
            0.007944883778691292,
            0.04691114276647568,
            -0.013986547477543354,
            0.015682343393564224,
            -0.0320599265396595,
            -0.04701406881213188,
            0.009964549914002419,
            0.006877901963889599,
            -0.06978292763233185,
            0.05309359356760979,
            0.000875369063578546,
            0.013603396713733673,
            -0.013405879959464073,
            0.005540358833968639,
            0.033407699316740036,
            0.0008230457315221429,
            0.028801636770367622,
            -0.052725259214639664,
            0.004269042983651161,
            0.021490570157766342,
            -0.015094895847141743,
            -0.009421741589903831,
            -0.028226852416992188,
            -0.014127551577985287,
            -0.012147407978773117,
            -0.02571938745677471,
            0.058202292770147324,
            -0.06562869250774384,
            -0.044928669929504395,
            0.023154057562351227,
            -0.020452259108424187,
            -0.018480101600289345,
            0.02768930047750473,
            -0.018020296469330788,
            -0.026547860354185104,
            0.013758311048150063,
            0.06455064564943314,
            -0.032941434532403946,
            0.005928625352680683,
            0.04318980127573013,
            -0.07685397565364838,
            0.030269106850028038,
            -0.00009901488374453038,
            0.06404226273298264,
            -0.07032797485589981,
            -0.0031808745115995407,
            0.060485709458589554,
            0.04309500753879547,
            0.0029428554698824883,
            0.08260573446750641,
            0.027409758418798447,
            0.026872562244534492,
            0.013088861480355263,
            0.007586834952235222,
            0.026790080592036247,
            0.04246785119175911,
            0.007160848472267389,
            0.006684847641736269,
            -0.058164071291685104,
            -0.09019573777914047,
            0.02381054311990738,
            -0.00707375118508935,
            -0.048579372465610504,
            0.005261553917080164,
            0.02489759400486946,
            -0.04895550012588501,
            0.041394222527742386,
            -0.06865045428276062,
            0.010092612355947495,
            0.033903926610946655,
            0.04304489865899086,
            -0.05754493176937103,
            -0.041257962584495544,
            -0.04608960449695587,
            -0.007796716410666704,
            -0.020878292620182037,
            0.0792107954621315,
            0.06575067341327667,
            0.003271965542808175,
            -0.0044423905201256275,
            0.04628027603030205,
            0.018571702763438225,
            0.03413937985897064,
            0.007914800196886063,
            0.013813866302371025,
            0.021163739264011383,
            0.052751995623111725,
            -0.06577912718057632,
            -0.06559233367443085,
            0.009597578085958958,
            0.008279390633106232,
            0.0073980181477963924,
            0.0020079766400158405,
            -0.0046630604192614555,
            -0.0007323009194806218,
            0.04007706418633461,
            -0.04156400263309479,
            0.024684352800250053,
            0.020384903997182846,
            0.014276069588959217,
            -0.006452513393014669,
            -0.029044533148407936,
            -0.06278033554553986,
            0.04587731882929802,
            -0.039480846375226974,
            -0.015423132106661797,
            -0.020524270832538605,
            0.024143898859620094,
            0.028638644143939018,
            -0.0097428597509861,
            0.013068683445453644,
            -0.03535257652401924,
            -0.006578372325748205,
            -0.011491820216178894,
            0.011819287203252316,
            -0.03016780875623226,
            0.03802225738763809,
            0.012475655414164066,
            -0.012821112759411335,
            0.01127537339925766,
            0.014777605421841145,
            -0.018802251666784286,
            -0.010226231999695301,
            -0.056102950125932693,
            0.023377949371933937,
            0.031876448541879654,
            0.00041071168379858136,
            -0.02441071905195713,
            0.05682054162025452,
            -0.010464213788509369,
            -0.07326942682266235,
            -0.07017344981431961,
            -0.0011038262164220214,
            -0.021429041400551796,
            -0.01319981925189495,
            0.013377192430198193,
            0.02303163893520832,
            -0.011052318848669529,
            -0.0462881363928318,
            -0.042625341564416885,
            0.054655931890010834,
            0.010473542846739292,
            0.028549911454319954,
            0.0007498679915443063,
            -0.02237611822783947,
            -0.01672997511923313,
            -0.004852584097534418,
            -0.044106632471084595,
            -0.023563306778669357,
            0.041339922696352005,
            0.0037315289955586195,
            0.028393596410751343,
            -0.06584519892930984,
            0.006103631108999252,
            0.027893267571926117,
            -0.013291056267917156,
            0.001467082998715341,
            0.0419054850935936,
            -0.0012787914602085948,
            -0.08602694422006607,
            -0.062279507517814636,
            -0.04595066234469414,
            -0.018392518162727356,
            0.02876165322959423,
            0.01814291998744011,
            -0.0044484809041023254,
            0.030615735799074173,
            -0.007310159504413605,
            -0.061013996601104736,
            -0.0449678897857666,
            0.03525066375732422,
            -0.025904212146997452,
            -0.021405180916190147,
            0.047598063945770264,
            -0.007515919394791126,
            0.005958828143775463,
            -0.014306445606052876,
            -0.04277123510837555,
            -0.061058420687913895,
            -0.05129566416144371,
            -0.02795627899467945,
            0.003219237318262458,
            -0.05941791832447052,
            0.01772140897810459,
            0.03178853541612625,
            -0.04889732599258423,
            0.045189399272203445,
            0.039687834680080414,
            -0.006747753359377384,
            -0.0033768601715564728,
            0.009595541283488274,
            -0.000668274937197566,
            -0.001464832341298461,
            -0.03362319990992546,
            -0.009201738983392715,
            -0.043816547840833664,
            -0.005818936508148909,
            0.058084797114133835,
            -0.006913571152836084,
            -0.007668116129934788,
            -0.015950564295053482,
            -0.003138740314170718,
            0.03904692083597183,
            -0.002255926374346018,
            0.0009560358594171703,
            0.01954512484371662,
            0.04225741699337959,
            0.023504571989178658,
            -0.040079180151224136,
            0.015610761940479279,
            0.0038255758117884398,
            -0.0068125477991998196,
            -0.03831496834754944,
            -0.05391276255249977,
            0.016167791560292244,
            0.056931622326374054,
            0.007301929406821728,
            0.03427934646606445,
            0.004519092384725809,
            0.03441610187292099,
            0.027110593393445015,
            0.04591745883226395,
            0.026259591802954674,
            -0.05635756999254227,
            -0.04495195299386978,
            0.02687792479991913,
            -0.00636313809081912,
            -0.06725139915943146,
            0.03458069637417793,
            -0.015785662457346916,
            -0.029375264421105385,
            0.028194041922688484,
            0.044567596167325974,
            0.047600697726011276,
            0.08376143872737885,
            -0.05587361752986908,
            -0.054221462458372116,
            0.020652953535318375,
            -0.014380424283444881,
            0.008377333171665668,
            -0.010063273832201958,
            -0.003058981616050005,
            0.05561774969100952,
            0.022524669766426086,
            -0.0307195745408535,
            0.02507624216377735,
            -0.03246556222438812,
            0.0546310655772686,
            -0.008781621232628822,
            0.030455905944108963,
            -0.007542786188423634,
            -0.07880014926195145,
            -0.045339759439229965,
            0.007515421137213707,
            -0.023717287927865982,
            0.0043373433873057365,
            -0.016465382650494576,
            -0.05754903331398964,
            -0.0468471385538578,
            -0.02007276378571987,
            0.03566160798072815,
            -0.04528611898422241,
            -0.03532731533050537,
            -0.0011506390292197466,
            -0.004821171518415213,
            -0.010825940407812595,
            0.030793387442827225,
            -0.054667070508003235,
            -0.004590313415974379,
            -0.047335218638181686,
            0.006257735658437014,
            0.03983047977089882,
            -0.03555113077163696,
            -0.008279366418719292,
            -0.030784128233790398,
            0.012883137911558151,
            -0.009017244912683964,
            0.05663479119539261,
            -0.021222639828920364,
            0.006210003048181534,
        ]
    ),
    distance_measure=DistanceMeasure.EUCLIDEAN,
    limit=20,
)
results = firestore_query.get()
print(f"RESULTS: {results}")

found_docs = list(results)
if not found_docs:
    print("FAILURE: The query returned 0 documents.")
else:
    print(f"SUCCESS: The query returned {len(found_docs)} documents.")
    for doc in found_docs:
        if not doc:
            continue
        doc_dict = doc.to_dict() or {}
        content = doc_dict.get("content")
        if content is None:
            print("Warning: document has no 'content' field or it is None")
        else:
            print(f"Found content: {content[:100]}...")
